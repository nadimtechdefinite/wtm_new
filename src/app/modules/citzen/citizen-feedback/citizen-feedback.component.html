<ng-container>

    <main class="pb-5" style="margin-bottom: 40px;">

        <div class="container-fluid">
            <div class="row" style="padding: 0px 10px;">
                <h3 class="main-title">Feedback</h3>
            </div>
              <nav class="mat-breadcrumb">
                <a mat-button routerLink="/layout/citizen/dashboard">Dashboard</a>
                <mat-icon>chevron_right</mat-icon>
                <span class="current">FeedBack</span>
                </nav>
            <section class="form-card">
                <h6 style="font-size: 20px;">Submit Your Feedback</h6>
                <br>
                <form [formGroup]="grievanceForm" novalidate>
                    <div class="row g-3 mb-3 row-box">

                        <div class="col-md-3">
                            <div>
                                <strong>Road Name</strong>
                                <p class="feedback-value">R/F PR road to Dhaba K</p>
                            </div>
                
                        </div>

                        <div class="col-md-3">
                             <div>
                                <strong>State</strong>
                                <p class="feedback-value">{{citzenDetails?.stateName}}</p>
                            </div>
                        
                        </div>

                        <div class="col-md-3">
                            <div>
                                <strong>District</strong>
                                <p class="feedback-value">{{citzenDetails?.districtName}}</p>
                            </div>
                         
                        </div>

                        <div class="col-md-3">
                              <div>
                                <strong>Block</strong>
                                <p class="feedback-value">{{citzenDetails?.blockName}}</p>
                            </div>
            
                        </div>

                    </div>

                    <div class="row g-3 mb-3">
                        <!-- State -->
                        <div class="col-md-3">
                           <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Name</mat-label>
                                <input matInput placeholder="Enter Name" maxlength="100" formControlName="name"
                                    autocomplete="off">
                                <mat-error *ngIf="(f['name'].touched || isSubmitted) && f['name'].invalid">
                                    Name is required
                                </mat-error>
                            </mat-form-field>
                        </div>

                    <div class="col-md-3">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Gender</mat-label>
                                <mat-select formControlName="gender">
                                    <mat-option value="">Select Gender</mat-option>
                                    <mat-option value="M">Male</mat-option>
                                    <mat-option value="F">Female</mat-option>
                                    <!-- <mat-option value="T">Transgender</mat-option>  -->
                                </mat-select>
                                <mat-error *ngIf="(f['gender'].touched || isSubmitted) && f['gender'].invalid">
                                    Gender is required
                                </mat-error>
                            </mat-form-field>
                        </div>
                        

                        <div class="col-md-3">
                             <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Category</mat-label>
                                <mat-select formControlName="catCode">
                                    <mat-option value="">Select Category</mat-option>
                                    <mat-option *ngFor="let cat of catListDetails" [value]="cat.id">{{ cat.name
                                        }}</mat-option>
                                </mat-select>
                                <mat-error *ngIf="(f['catCode'].touched || isSubmitted) && f['catCode'].invalid">
                                    Scheme is required
                                </mat-error>
                            </mat-form-field>
                            <!-- <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Pin Code</mat-label>
                                <input matInput placeholder="Enter Pin Code" (input)="onPinInput()" maxlength="6"
                                    formControlName="pinCode" autocomplete="off">
                                <mat-error *ngIf="(f['pinCode'].touched || isSubmitted) && f['pinCode'].invalid">
                                    Name is required
                                </mat-error>
                            </mat-form-field> -->
                        </div>

                         <div class="col-md-3">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Mobile</mat-label>
                                <input matInput placeholder="Enter Pin Code" 
                                    formControlName="mobile" autocomplete="off">
                            </mat-form-field>
                        </div>
                    </div>

                    <!-- Grievance Section -->
                    <!-- <h6 class="title-label">Registration of Grievance</h6> -->
                    <div class="row g-3 mb-3">

                        <!-- Ministry -->
                        <!-- <div class="col-md-4">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Department</mat-label>
                                <mat-select formControlName="ministry" (selectionChange)="selectedMinister($event)">
                                    <mat-option value="">Select Department</mat-option>
                                    <mat-option *ngFor="let m of ministryList" [value]="m.ministryCode">
                                        {{ m.ministryName }} {{ m.ministryShortName }}
                                    </mat-option>
                                </mat-select>
                                <mat-error *ngIf="(f['ministry'].touched || isSubmitted) && f['ministry'].invalid">
                                    Ministry is required
                                </mat-error>
                            </mat-form-field>
                        </div> -->

                        <!-- Scheme -->
                        <!-- <div class="col-md-4">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Scheme</mat-label>
                                <mat-select formControlName="schemeCode" (selectionChange)="onSchameChange($event)">
                                    <mat-option value="">Select Scheme</mat-option>
                                    <mat-option *ngFor="let s of schemeList" [value]="s.schemeCode">{{ s.schemeName
                                        }}</mat-option>
                                </mat-select>
                                <mat-error *ngIf="(f['schemeCode'].touched || isSubmitted) && f['schemeCode'].invalid">
                                    Scheme is required
                                </mat-error>
                            </mat-form-field>
                        </div> -->

                          <!-- Scheme -->
                        <!-- <div class="col-md-4">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Category</mat-label>
                                <mat-select formControlName="catCode">
                                    <mat-option value="">Select Category</mat-option>
                                    <mat-option *ngFor="let cat of catListDetails" [value]="cat.id">{{ cat.name
                                        }}</mat-option>
                                </mat-select>
                                <mat-error *ngIf="(f['catCode'].touched || isSubmitted) && f['catCode'].invalid">
                                    Scheme is required
                                </mat-error>
                            </mat-form-field>
                        </div> -->
                    </div>
                    <!-- Description -->
                    <div class="row g-3 mb-3">
                        <div class="col-md-8">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Description of Grievance</mat-label>
                                <textarea matInput rows="2" formControlName="Description"
                                    (input)="micActive ? null : onDescriptionInput($event)"></textarea>
                                <mat-error *ngIf="f['Description'].hasError('required') && (f['Description'].touched || isSubmitted)">
                                    Description is required
                                    </mat-error>

                                    <mat-error *ngIf="f['Description'].hasError('minlength')">
                                    Minimum 5 characters required
                                    </mat-error>

                                    <mat-error *ngIf="f['Description'].hasError('maxlength')">
                                    Maximum 1000 characters allowed
                                    </mat-error>

                            </mat-form-field>
                            <small class="text-muted d-block text-end">
                            {{ descriptionLength }} / 1000
                            </small>
                        </div>
                              <div class="col-md-4">
                            <label>Attachment</label>

                            <div class="d-flex align-items-center gap-2">
                                <!-- Hidden file input -->
                                <input type="file" hidden #fileInput
                                    (change)="checkUpLoadedAttachmentFormat($event, '1')"
                                    accept=".jpg,.jpeg,.png,.pdf" />

                                <!-- Choose File button (show only if no file selected) -->
                                <button *ngIf="!fileName" mat-stroked-button color="primary" type="button"
                                    (click)="fileInput.click()">
                                    Choose File
                                </button>

                                <!-- File name + clear button -->
                                <ng-container *ngIf="fileName">
                                    <span class="text-truncate">{{ fileName }}</span>

                                    <!-- Clear (cross) button -->
                                    <button mat-icon-button color="warn" type="button" aria-label="Remove file"
                                        style="background-color: #ff00001f;" (click)="clearFile(fileInput)"
                                        matTooltip="Close">
                                        <mat-icon>close</mat-icon>
                                    </button>
                                    <button style="background-color: #0d5db940;" mat-icon-button color="primary"
                                        type="button" aria-label="Preview file" (click)="previewSelectedFile()"
                                        matTooltip="Close">
                                        <mat-icon>visibility</mat-icon>
                                    </button>
                                </ng-container>
                            </div>

                            <mat-hint>Only JPEG / PNG / PDF files allowed (Max 10MB).</mat-hint>
                        </div>
                        <!-- <div class="col-md-3">
                            <mat-form-field appearance="outline" class="w-100">
                                <mat-label>Language</mat-label>
                                <mat-select formControlName="Language" (selectionChange)="onLanguageChange($event)">
                                    <mat-option value="">Select Language</mat-option>
                                    <mat-option *ngFor="let lang of languages" [value]="lang.code">{{ lang.label }}</mat-option>
                                </mat-select>
                                <mat-error *ngIf="(f['Language'].touched || isSubmitted) && f['Language'].invalid">
                                    Language is required
                                </mat-error>
                            </mat-form-field>
                        </div>
                        <div class="col-md-1 d-flex flex-column">
                            <button type="button" class="btn w-50 mic-btn" [ngClass]="{ 'mic-active': micActive }"
                                (click)="toggleMic()" title="Voice Input">
                                <i class="fa" [ngClass]="micActive ? 'fa-microphone' : 'fa-microphone'"></i>
                                <span>{{ micActive ? '' : '' }}</span>
                            </button>
                            <div *ngIf="micActive" class="text-danger mt-0 ms-1">
                                {{ message }}
                            </div>
                        </div> -->

                    </div>

                
                </form>
                <div class="text-center mt-3 d-flex gap-2 justify-content-center align-items-center">
                    <button mat-raised-button color="primary" class="btn-glow btn-blue" type="submit"
                        (click)="onSubmit()">
                        Submit
                    </button>
                    <button mat-raised-button color="warn" class="btn-glow btn-red" type="reset" (click)="resetForm()">
                        Reset
                    </button>
                </div>
            </section>
        </div>

    </main>
</ng-container>
<ng-template #pdfDialog>
    <div #saveAsPdf>
        <!-- Header -->
        <div class="d-flex align-items-center header-box mb-3">
            <img src="assets/images/logo_wtm.png" style="    width: 43px;
    margin: 20px;" alt="emblem" class="logo-img me-3" />
            <div class="text-start">
                <div class="fw-bold fs-5 text-primary">Write To Rural Development Minister</div>
                <div class="fw-semibold fs-6 text-secondary">A Grievance Redressel System For Users</div>
            </div>
        </div>

        <mat-dialog-content>
            <!-- Card Body -->
            <div #pdfCard class="card pdf-card p-4 shadow-sm border-0 rounded-4">
                <div class="my-3">
                    <p class="fs-6 mb-2">
                        <span class="fw-bold">Dear {{ userName.toUpperCase() }},</span>
                    </p>
                    <p class="fs-6 mb-2">
                        Your grievance has been successfully registered.
                        <!-- Your grievance Id <span class="fw-bold">{{ generatedComplaintId }}</span> -->
                        It will be forwarded to the respective nodal <span class="fw-bold">{{ schemeName }}</span>.
                    </p>
                    <p class="fs-6 mb-0">
                        Kindly note down your grievance number:
                        <span class="grievance-number">{{ generatedComplaintNo }}</span> for further tracking.
                    </p>
                </div>

                <hr class="my-3" />

                <!-- Footer -->
                <div class="footer-box d-flex justify-content-between align-items-center">
                    <span class="fs-7 text-muted">
                        Report generated on: <b>{{ currentDate | date: 'dd-MMM-yyyy' }}</b>
                    </span>
                    <!-- <a href="https://write2rdminister.dord.gov.in/#/home" target="_blank" class="footer-link">
                        Visit Portal
                    </a> -->
                </div>
            </div>
        </mat-dialog-content>

        <!-- Dialog Actions -->

    </div>
    <mat-dialog-actions align="end" class="mt-3">
        <button mat-flat-button color="primary" (click)="generatePdf()">Download PDF</button>
        <button mat-stroked-button mat-dialog-close (click)="closeDialog()">Close</button>
    </mat-dialog-actions>
</ng-template>